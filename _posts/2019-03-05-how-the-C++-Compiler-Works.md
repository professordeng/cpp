# how the C++ Compiler Works

C++ 从文本文件到可执行文件需要两个最主要的过程，分别是编译和链接，那编译过程是怎么样的，中间要经过哪些步骤？

## 预处理

首先会进行预处理操作，那什么是预处理操作呢。

```c++
#include <iostream>
#define INTEGER int
#if 1
Log();
#endif
```

如上，这些 `#` 开头的语句都是预处理命令，预处理操作就是处理这些语句的。预处理语句的功能正如其名字。

include 是将文本文件的内容全部拷贝过来。

define 是将所有 INTEGER 替换成 int ，也就是简单的替换功能

if 语句是真的话将包含的内容保留下来。预处理就是源文件的宏展开。

## 编译

每一个源文件都是一个编译单元，编译器对代码进行语义分析，进行翻译生成 obj 文件，每一个源文件在编译过程中都是相互独立的。对象文件（obj）虽然是二进制文件，但是不一定能执行，因为不是每一个对象文件都有 main 函数。当编译器将一个工程里的所有源文件以分离的方式编译完毕后，再由链接器进行链接成为一个可执行文件或动态链接库。

目标文件是编译后生成的文件，以机器码的形式包含了编译单元里所有的函数和数据、导出符号表、未解决符号表、地址重定向表等。目标文件有以下几类

1. 可重定位文件（.o 文件）

   其中包含有适合于其它目标文件链接来创建一个可执行的或者共享的目标文件的代码和数据。每个 `cpp` 文件会被编译成一个可重定位文件。

2. 共享的目标文件（库文件）

   - 静态库（链接程序）

     态链接库实际上是一个目标文件的集合，其中的每个文件含有库中的一个或者一组相关函数的代码，可把它与其它可重定位文件及共享的目标文件一起处理来创建另一个目标文件。

   - 动态库（动态链接程序）

     和静态库不同，动态链接库在程序执行时才被调用，将它与另一个可执行文件及其它的共享目标文件结合到一起，创建一个进程映象。

`对象文件在编译后就能获得，但是库文件、可执行文件都需要在链接后才能获得。



## 优化

很多无效代码会被优化。



 